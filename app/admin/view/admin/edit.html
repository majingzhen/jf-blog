<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><?php echo $title; ?></title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- 引入 AI Editor 的 CSS 和 JS -->
    <link rel="stylesheet" href="/static/aieditor/css/aieditor.min.css">
    <script src="/static/aieditor/js/aieditor.min.js"></script>
    <style>
        body {
            background-color: #f8f9fa;
        }
        .sidebar {
            min-height: 100vh;
            background-color: #343a40;
            color: white;
        }
        .main-content {
            padding-top: 20px;
        }
        #editor {
            height: 400px; /* 可根据需要调整 */
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <nav class="col-md-2 d-md-block sidebar p-3">
                <h5 class="text-white">JF-Blog Admin</h5>
                <ul class="nav flex-column">
                    <li class="nav-item">
                        <a class="nav-link text-white" href="<?php echo url('admin.Index/index'); ?>">仪表盘</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active text-white" href="<?php echo url('admin.Post/index'); ?>">文章管理</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-white" href="<?php echo url('admin.Category/index'); ?>">分类管理</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-white" href="<?php echo url('admin.Tag/index'); ?>">标签管理</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-white" href="<?php echo url('admin.Config/index'); ?>">系统配置</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-white" href="<?php echo url('admin.Login/logout'); ?>">退出登录</a>
                    </li>
                </ul>
            </nav>

            <!-- Main Content -->
            <main class="col-md-10 ms-sm-auto main-content">
                <div class="container-fluid">
                    <h1><?php echo $title; ?></h1>

                    <form action="<?php echo url('admin.Post/save'); ?>" method="post">
                        <input type="hidden" name="id" value="<?php echo $post['id']; ?>">
                        <div class="mb-3">
                            <label for="title" class="form-label">标题</label>
                            <input type="text" class="form-control" id="title" name="title" value="<?php echo htmlspecialchars($post['title']); ?>" required>
                        </div>

                        <div class="mb-3">
                            <label for="slug" class="form-label">URL 别名 (可选)</label>
                            <input type="text" class="form-control" id="slug" name="slug" value="<?php echo htmlspecialchars($post['slug']); ?>">
                            <div class="form-text">如果留空，系统将根据标题自动生成。</div>
                        </div>

                        <div class="mb-3">
                            <label for="summary" class="form-label">摘要</label>
                            <textarea class="form-control" id="summary" name="summary" rows="3"><?php echo htmlspecialchars($post['summary']); ?></textarea>
                        </div>

                        <div class="mb-3">
                            <label for="editor" class="form-label">内容</label>
                            <div id="editor"></div>
                            <input type="hidden" id="content" name="content" value="">
                        </div>

                        <div class="mb-3">
                            <label for="category_id" class="form-label">分类</label>
                            <select class="form-select" id="category_id" name="category_id" required>
                                <option value="">请选择分类</option>
                                <?php foreach ($categories as $category): ?>
                                <option value="<?php echo $category['id']; ?>" <?php echo $post['category_id'] == $category['id'] ? 'selected' : ''; ?>>
                                    <?php echo htmlspecialchars($category['name']); ?>
                                </option>
                                <?php endforeach; ?>
                            </select>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">标签</label>
                            <div>
                                <?php foreach ($allTags as $tag): ?>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" id="tag_<?php echo $tag['id']; ?>" name="tag_ids[]" value="<?php echo $tag['id']; ?>" 
                                           <?php echo in_array($tag['id'], $selectedTagIds) ? 'checked' : ''; ?>>
                                    <label class="form-check-label" for="tag_<?php echo $tag['id']; ?>"><?php echo htmlspecialchars($tag['name']); ?></label>
                                </div>
                                <?php endforeach; ?>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="status" class="form-label">状态</label>
                            <select class="form-select" id="status" name="status">
                                <option value="draft" <?php echo $post['status'] == 'draft' ? 'selected' : ''; ?>>草稿</option>
                                <option value="published" <?php echo $post['status'] == 'published' ? 'selected' : ''; ?>>发布</option>
                            </select>
                        </div>

                        <div class="mb-3">
                            <label for="seo_keywords" class="form-label">SEO 关键词</label>
                            <input type="text" class="form-control" id="seo_keywords" name="seo_keywords" value="<?php echo htmlspecialchars($post['seo_keywords']); ?>">
                            <div class="form-text">多个关键词用英文逗号分隔。</div>
                        </div>

                        <div class="mb-3">
                            <label for="seo_description" class="form-label">SEO 描述</label>
                            <textarea class="form-control" id="seo_description" name="seo_description" rows="2"><?php echo htmlspecialchars($post['seo_description']); ?></textarea>
                        </div>

                        <button type="submit" class="btn btn-primary">更新</button>
                        <a href="<?php echo url('admin.Post/index'); ?>" class="btn btn-secondary">取消</a>
                    </form>
                </div>
            </main>
        </div>
    </div>

    <script>
        // 初始化 AI Editor
        const editor = new AIEditor({
            el: '#editor',
            value: <?php echo json_encode(htmlspecialchars_decode($post['content'])); ?> // 预填充内容
            // 可以根据 AI Editor 文档配置更多选项
            // mode: 'markdown', // 默认模式，也可以是 'wysiwyg'
            // theme: 'light', // 或 'dark'
        });

        // 在表单提交前，将编辑器内容同步到隐藏的 input
        document.querySelector('form').addEventListener('submit', function(e) {
            document.getElementById('content').value = editor.getMarkdown(); // 或 editor.getHTML() 如果后端需要 HTML
        });
    </script>
</body>
</html>